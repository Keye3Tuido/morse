<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>电报按钮模拟</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0f172a; /* 深色背景 */
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .button {
      appearance: none;
      border: none;
      outline: none;
      cursor: pointer;
      width: 150px;
      height: 150px;
      border-radius: 50%; /* 圆形 */
      background: radial-gradient(circle at 30% 30%, #ef4444, #b91c1c); /* 红色渐变 */
      box-shadow:
        0 12px 24px rgba(0,0,0,0.25),
        inset 0 2px 6px rgba(255,255,255,0.3),
        inset 0 -2px 6px rgba(0,0,0,0.2);
      transition: transform 80ms ease, box-shadow 120ms ease;
      user-select: none;
      touch-action: manipulation;
    }
    .button:active {
      transform: scale(0.95);
      box-shadow:
        0 8px 16px rgba(0,0,0,0.3),
        inset 0 2px 6px rgba(255,255,255,0.2),
        inset 0 -2px 6px rgba(0,0,0,0.3);
    }

    /* 移动端适配 */
    @media (max-width: 600px) {
      .button {
        width: 100px;
        height: 100px;
      }
    }
  </style>
</head>
<body>
  <button id="telegraphBtn" class="button" aria-label="电报按钮"></button>

  <script>
    let audioCtx = null;
    let osc = null;
    let gainNode = null;
    let isLongPress = false;
    let pressTimer = null;
    const LONG_PRESS_THRESHOLD_MS = 200;
    const BEEP_FREQ_HZ = 800;
    const BEEP_VOLUME = 0.2;

    function ensureAudioContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function playShortBeep(durationMs = 120) {
      ensureAudioContext();
      const now = audioCtx.currentTime;
      const oscLocal = audioCtx.createOscillator();
      const gainLocal = audioCtx.createGain();

      oscLocal.type = 'sine';
      oscLocal.frequency.setValueAtTime(BEEP_FREQ_HZ, now);

      gainLocal.gain.setValueAtTime(0, now);
      gainLocal.gain.linearRampToValueAtTime(BEEP_VOLUME, now + 0.01);
      gainLocal.gain.linearRampToValueAtTime(0, now + durationMs / 1000);

      oscLocal.connect(gainLocal).connect(audioCtx.destination);
      oscLocal.start(now);
      oscLocal.stop(now + durationMs / 1000 + 0.02);
    }

    function startContinuousTone() {
      ensureAudioContext();
      const now = audioCtx.currentTime;
      osc = audioCtx.createOscillator();
      gainNode = audioCtx.createGain();

      osc.type = 'sine';
      osc.frequency.setValueAtTime(BEEP_FREQ_HZ, now);

      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(BEEP_VOLUME, now + 0.03);

      osc.connect(gainNode).connect(audioCtx.destination);
      osc.start(now);
    }

    function stopContinuousTone() {
      if (!audioCtx || !osc || !gainNode) return;
      const now = audioCtx.currentTime;
      gainNode.gain.cancelScheduledValues(now);
      gainNode.gain.setValueAtTime(gainNode.gain.value, now);
      gainNode.gain.linearRampToValueAtTime(0, now + 0.03);
      try { osc.stop(now + 0.05); } catch (_) {}
      osc.disconnect();
      gainNode.disconnect();
      osc = null;
      gainNode = null;
    }

    function onPressStart(e) {
      e.preventDefault();
      isLongPress = false;
      clearTimeout(pressTimer);
      pressTimer = setTimeout(() => {
        isLongPress = true;
        startContinuousTone();
      }, LONG_PRESS_THRESHOLD_MS);
    }

    function onPressEnd(e) {
      e.preventDefault();
      clearTimeout(pressTimer);
      if (isLongPress) {
        stopContinuousTone();
      } else {
        playShortBeep();
      }
      isLongPress = false;
    }

    function onPressCancel() {
      clearTimeout(pressTimer);
      if (isLongPress) stopContinuousTone();
      isLongPress = false;
    }

    const btn = document.getElementById('telegraphBtn');
    btn.addEventListener('mousedown', onPressStart);
    btn.addEventListener('mouseup', onPressEnd);
    btn.addEventListener('mouseleave', onPressCancel);
    btn.addEventListener('touchstart', onPressStart, { passive: false });
    btn.addEventListener('touchend', onPressEnd, { passive: false });
    btn.addEventListener('touchcancel', onPressCancel, { passive: false });
    window.addEventListener('blur', onPressCancel);
  </script>
</body>
</html>
